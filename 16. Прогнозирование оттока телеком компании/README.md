# [Прогнозирование оттока телеком компании](https://github.com/Urchien/Yandex_Practicum/blob/main/16.%20%D0%9F%D1%80%D0%BE%D0%B3%D0%BD%D0%BE%D0%B7%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D0%BE%D1%82%D1%82%D0%BE%D0%BA%D0%B0%20%D1%82%D0%B5%D0%BB%D0%B5%D0%BA%D0%BE%D0%BC%20%D0%BA%D0%BE%D0%BC%D0%BF%D0%B0%D0%BD%D0%B8%D0%B8/customer_churn_research_final.ipynb)

## Статус проекта - завершен.

## Описание проекта

Оператор связи «Ниединогоразрыва.ком» хочет научиться прогнозировать отток клиентов. Если выяснится, что пользователь планирует уйти, ему будут предложены промокоды и специальные условия. Команда оператора собрала персональные данные о некоторых клиентах, информацию об их тарифах и договорах.

**Оператор предоставляет два основных типа услуг:** 
1. Стационарную телефонную связь. Возможно подключение телефонного аппарата к нескольким линиям одновременно.
2. Интернет. Подключение может быть двух типов: через телефонную линию (DSL, от англ. digital subscriber line, «цифровая абонентская линия») или оптоволоконный кабель (Fiber optic).

**Также доступны такие услуги:**

- Интернет-безопасность: антивирус (DeviceProtection) и блокировка небезопасных сайтов (OnlineSecurity);
- Выделенная линия технической поддержки (TechSupport);
- Облачное хранилище файлов для резервного копирования данных (OnlineBackup);
- Стриминговое телевидение (StreamingTV) и каталог фильмов (StreamingMovies).

За услуги клиенты могут платить каждый месяц или заключить договор на 1–2 года. Доступны различные способы расчёта и возможность получения электронного чека.

## Описание данных

**Данные состоят из файлов, полученных из разных источников:**

Во всех файлах столбец customerID содержит код клиента.

**Датафрейм contract_new — информация о договоре**
- customerID — ID абонента;
- BeginDate — дата начала действия договора;
- EndDate — дата окончания действия договора;
- Type — тип оплаты: раз в год-два или ежемесячно;
- PaperlessBilling — электронный расчётный лист;
- PaymentMethod — тип платежа;
- MonthlyCharges — расходы за месяц;
- TotalCharges — общие расходы абонента.

**Датафрейм personal_new — персональные данные клиента**
- customerID — ID пользователя;
- gender — пол;
- SeniorCitizen — является ли абонент пенсионером;
- Partner — есть ли у абонента супруг или супруга;
- Dependents — есть ли у абонента дети.

**Датафрейм internet_new — информация об интернет-услугах**
- customerID — ID пользователя;
- InternetService — тип подключения;
- OnlineSecurity — блокировка опасных сайтов;
- OnlineBackup — облачное хранилище файлов для резервного копирования данных;
- DeviceProtection — антивирус;
- TechSupport — выделенная линия технической поддержки;
- StreamingTV — стриминговое телевидение;
- StreamingMovies — каталог фильмов.

**Датафрейм phone_new — информация об услугах телефонии**
- customerID — ID пользователя;
- MultipleLines — подключение телефона к нескольким линиям одновременно.

Информация о договорах актуальна на 1 февраля 2020.

## Примененные инструменты

- Python
- Pandas
- Numpy
- Matplotlib
- Seaborn
- Scikit-learn
- Statsmodels
- Re
- Math
- Phik
- Xgboost
- Catboost

## План работ

1. **Первичный анализ данных** (Загрузим данные, посмотрим на них и опишем результат)
2. **Предобработка данных** (Объединим все данные в один датафрейм, приведем данные к нормальному виду, при наличии избавимся от пропусков, дубликатов и аномальных значений, ну и обязательно еще чтонибудь накопаем)
3. **Исследовательский анализ данных** (Исследуем данные на наличие связей, посмотрим корреляцию, определимся какие признаки оставим для машинного обучения)
4. **Подготовка данных к машинному обучению** (Разобьем на тренировочную и тестовую выборки, подготовим признаки,  посмотрим баланс классов, определимся с метриками, и т.д.)
5. **Подбор и обучение моделей машинного обучения** (Выберем несколько методов ML, подберем лучшие гиперпараметры на кросс-валидации)  
5. **Тестирование лучшей модели** (Протестируем модель показавшую лучшие метрики на тестовой выборке и сравним с константной моделью)
6. **Вывод** (Сделаем анализ лучшей модели, опишем важность признаков, построим матрицу ошибок. Также напишем вывод о проделаной работе)

## Результаты исследования

**В этом проекте мы, согласно плану реализовали следующие пункты:**
1. Провели первичный анализ данных: 
    - Загрузили и описали данные.
2. Провели предобработку данных: 
    - Объединили 4 датафрейма в один.
    - Привели данные к нормальному виду.
    - Обработали пропущенные значения.
    - Выделили целевой признак для машинного обучения.
3. Провели исследовательский анализ данных:
    - Исследовали признаки, выделили незначимые и малозначимые признаки для машинного обучения.
    - Обнаружили связи и зависимости в данных, что помогло составить примерный портрет уходящего клиента - это человек не имеют пенсионного статуса, состояший в браке и не имеющий детей.
    - Выявили, что среди оплаты преобладает помесячная.
    - Дополнительные услуги пользуется низкой популярностью среди клиентов.
    - Резкий рост клиентов скорее всего всязан с провдением промоакций.
    - С 2015 года наблюдается рост количества ушедших пользователей компании.
    - В среднем клиент пользуется услугами компании 2.5 года.
    - Удалили признаки begin_date', 'end_date' и 'gender' как незначимые для машинного обучения.
    - Проверили корреляцию признаков с порогом 0.8 и удалили признаки 'total_charges', 'streaming_movies', 'streaming_tv' и 'internet_service', превышавшие порог корреляции.
4. Подготовили данные к машинному обучению:
    - Посмотрели баланс классов целевого признака и выявили дисбаланс классов целевого признака.
    - Определились с метриками - ROC-AUC, как не чуствительную к дисбалансу классов целевого признака.
    - Определились с методом кросс-валидации - StratifiedKFold, как оптимальным для работы с несбалансированным набором данных.
    - Разбили данные на тренировочную и тестовую выборки    .
5. Подборали и обучили модели машинного обучения:
    - Выбрали 4 модели: LogisticRegression, RandomForestClassifier, CatBoostClassifier и XGBClassifier.
    - Для подбора лучших гиперпараметров на кросс-валидации мы закодировали тренировочную выборку применив StandardScaler к числовым признакам и OneHotEncoder к категориальным признакам.
    - При помощи RandomizedSearchCV, обработали каждую модель по отдельности и вывели результат в сводную таблицу. По результатам подбора, лучшей моделью оказалась CatBoostClassifier с метрикой 0.9105.
6. Провели тестирование лучшей модели:
    - Проверили на тестовых данных модель CatBoostClassifierи:
        - Модель показала метрики ROC-AUC - 0.9116, accuracy - 0.9103
        - Провели анализ матрицы ошибок и ROC-кривой и обнаружили:
        - ROC -кривая показала высокое значение по оси Y
        - Процент верных предсказаний для класса 0 составляет около 91.93%, процент ошибок составляет около 8.03%. Для класса 1 процент предсказаний верных около 92.44%, а процент ошибок около 7,56%.

**На основе полученых результатов можем сделать вывод, что обученную модель (CatBoostClassifier) можно с успехом применять для поставленных задач.**